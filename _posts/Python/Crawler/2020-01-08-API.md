---

layout: post

title: "API 활용"

date: 2020-01-08 13:50:07

categories: [Python/Crawler]

description:

image: /img/api.png

published: true

canonical_url:

---

## API?

### API(Application Programming Interface)

-	응용 프로그램에서 사용할 수 있도록, 운영 체제나 프로그래밍 언어가 제공하는 기능을 제어할 수 있게 만든 인터페이스
- 두개의 시스템이 서로 상호 작용하기 위한 인터페이스
- API라 하면 보통 REST API를 지칭
- 웹사이트는 HTTP(S) 프로토콜을 사용하는 REST API 기반으로 구축

<br> <img src="/img/API.JPG" width="400">

------------------------------------------

## API 접근 권한

### Authentication VS Authorization
- Authentication: Identity(정체)가 맞다는 증명
- Authorization: API를 통한 어떠한 액션을 허용

API가 Authentication을 하여도 어떠한 액션에 대해서는 Authorization을 허용하지 않을 수 있음

### API의 시큐리티(보안)

어떠한 시큐리티 (보안) 방안이 없을 경우:
- DELETE 리퀘스트를 통해서 다른 이용자의 정보를 지울 수도 있음
- 제 3자에게 데이터 유출로 이어질 수 있음
- 누가 API를 사용하는지, 어떤 정보를 가져가는지 트래킹 할 수 없음

### API Key

API Key란 Request URL 혹은 Request 헤더에 포함되는 긴 스트링

### Basic Auth

Basic Auth의 경우 username:password 와 같은 Credential을 Base64로 인코딩한 값을 Request 헤더 안에 포함

### Resource
API를 통해 리턴된 정보
하나의 Resource 안에 여러개의 Endpoints가 존재

### Endpoint
Resource를 엑세스하는 경로/방법

`GET/comapaigns/{campaign_id}/actions/send`

- GET: Method
- comapaigns/{campaign_id}/actions/send: Endpoint

### Method

|Method|내용|
|------|----|
|GET|해당 리소스를 조회하고 정보를 가져옴|
|HEAD|GET 방식과 동일하나 응답코드와 HEAD만 가져옴|
|POST|요청된 리소스를 생성|
|PUT|요청된 리소스를 업데이트|
|DELETE|요청된 리소스를 삭제|

--------------------------------------------

## requests 모듈

-	http request/response를 위한 모듈
-	HTTP method를 메소드 명으로 사용하여 request 요청

### get 요청하기
1. http get 요청하기
2. query parameter 이용하여 데이터 전달하기

```python
url = 'https://hwk0702.github.io/'
resp = requests.get(url)
```

### post 요청하기
1. http post 요청하기
2. post data 이용하여 데이터 전달하기

```python
url = 'https://hwk0702.github.io/'
datas = {
  'id': 'abcd'
  'pwd': '1234'
}

resp = requests.post(url, data=datas)
```

### HTTP header 데이터 이용하기
1. header 데이터 구성하기
2. header 데이터 전달하기

```python
url = 'https://hwk0702.github.io/'
headers = {
  'user-agent': Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/79.0.3945.88 Safari/537.36
}
resp = requests.get(url, header=headers)
```

### HTTP response 처리하기
1. response 객체의 이해
2. status_code 확인하기
3. text 속성 확인하기

```python
url = 'https://hwk0702.github.io/'
resp = requests.get(url)

if resp.status_code == 200:
  resp.text
else:
  print('error')
```
----------------------------------------------

## API 사용하기

1. API 사용 요청 / 키 발급
2. API 문서(specification) 확인
3. API 테스트 및 개발

### Endpoint 확인하기
- API가 서비스 되는 서버의 IP 혹은 domain wnth

### key 값 확인하기
- 서비스 호출 트래킹할 목적이나 악의적인 사용을 금지할 목적으로 주로 사용

### parameter 확인하기
- API 호출에 필요한 parameter 값 확인 및 구성

### 요청 및 Response 확인
- request 모듈을 활용하여 API 호출
- response 확인하여 원하는 정보 추출
- json 데이터의 경우, python dictionary로 변경하여 사용가능

-------------------------------------------------------------------

## API 활용 예시
- 공공 데이터 포털에서 관광자원통계서비스 활용
- urllib.request 모듈 사용

```python
import urllib.request
import json

ym = '201201'
sido = urllib.parse.quote('서울특별시')
gungu = urllib.parse.quote('종로구')
res_nm = urllib.parse.quote('경복궁')
page_no = '1'
num_of_rows = '100'
service_key = 'YOUR SERVICE_KEY'

url = 'YOUR URL'
url = url + "&YM=" + ym
url = url + "&SIDO=" + sido
url = url + "&GUNGU=" + gungu
url = url + "&RES_NM=" + res_nm
url = url + "&pageNo=" + page_no
url = url + "&numOfRows=" + num_of_rows
url = url + "&serviceKey=" + service_key

req = urllib.request.Request(url)
response = urllib.request.urlopen(req)
j = json.loads(response.read().decode('utf-8'))

print(ym, j['response']['body']['items']['item']['csForCnt'], j['response']['body']['items']['item']['csNatCnt'])
```

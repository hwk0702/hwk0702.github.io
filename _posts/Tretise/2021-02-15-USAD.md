---

layout: post

title: "USAD : UnSupervised Anomaly Detection on Multivariate Time Series"

date: 2021-02-15 19:30:07

categories: [Treatise Review]

description:

image: /img/USAD.png

published: True

canonical_url:

tags: [Anomaly Detection, Unsupervised, Time series, USAD, UnSupervised Anomaly Detection on Multivariate Time Series]

---

> USAD : UnSupervised Anomaly Detection on Multivariate Time Series
> Julien Audibert, Pietro Michiardi, FrÃ©dÃ©ric Guyard, SÃ©bastien Marti, Maria A. Zuluaga, KDD 2020
>
> ë…¼ë¬¸ì„ ì½ê³  ê³ ë ¤ëŒ€í•™êµ ì‚°ì—…ê²½ì˜ê³µí•™ë¶€ DSBA ì—°êµ¬ì‹¤ ìµœí¬ì • ì„ ë°°ë‹˜ì˜ ì„¸ë¯¸ë‚˜ ë°œí‘œ ìë£Œë¥¼ ì°¸ê³ í•˜ì˜€ìŠµë‹ˆë‹¤.
>
> [![[Paper Review] USAD: UnSupervised Anomaly Detection on Multivariate Time Series](https://img.youtube.com/vi/gCleQ9JxibI/mqdefault.jpg)](https://youtu.be/gCleQ9JxibI)


## USAD : UnSupervised Anomaly Detection on Multivariate Time Series

- ì°¨ë³„ì  : ê²°ê³¼ê°€ ì¢‹ì€ ì—¬ëŸ¬ ê¸°ë²•ë“¤ì´ ì¡´ì¬í•˜ì§€ë§Œ, ìˆ˜í–‰ ê¸°ì¤€ì—ì„œ training time(i.e. energy consumption)ì„ ê³ ë ¤í•˜ì§€ ì•ŠëŠ”ë‹¤.

### Problem formulation

- Dataset : set of multivariate time series

$$\mathscr{T}=\left \{ \textbf{x}_1, \dots, \textbf{x}_T \right \}, \;\;\textbf{x}\in \mathbb{R}^m$$

- window : ê¸¸ì´ê°€ kì¸ time window

$$W_t=\left \{ \textbf{x}_{t-K+1}, \dots, \textbf{x}_{t-1}, \textbf{x}_t \right \}$$

- time windowë¥¼ inputìœ¼ë¡œ tì‹œì ì˜ normal/abnormal ì—¬ë¶€ë¥¼ ì˜ˆì¸¡

<img src='/img/usad1.png' width='600'>

-----

### Unsupervised Anomaly Detection

#### AE-based multivariate time series AD

- Autoencoder êµ¬ì¡°ì¸ Encoder $$E$$ì™€ Decoder $$D$$ë¥¼ ì´ìš©
- original input vector $$X$$ì™€ reconstruction $$R$$ì˜ ì°¨ì´ì¸ reconstruction errorë¥¼ ìµœì†Œí™”
- ì •ìƒë°ì´í„°ì˜ reconstruction errorë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•™ìŠµí•˜ì—¬ ì •ìƒ ë°ì´í„°ì˜ ë¶„í¬ë¥¼ í•™ìŠµí•¨
- reconstruction errorë¥¼ anomaly scoresë¡œ ì‚¬ìš©, thresholdë¥¼ ì´ˆê³¼í•˜ë©´ ì´ìƒì¹˜ë¡œ íƒì§€í•¨

$$\begin{matrix}
\text{as:} & \\ 
 & \;\;\;\;\;\;\; \mathscr{L}_{AE}=\left \| X-AE(X) \right \|_2,\\ 
\text{where} & \\ 
 & \;\;\;\;\;\;\; AE(X)=D(Z), \;\;\; Z=E(X)\\ 
\end{matrix}$$

$$\text{and } \left \| \cdot \right \|_2 \text{ denotes the L2-norm.}$$

<img src='/img/usad3.png' width='600'>

- ë‹¨ì : anomalyê°€ ë§¤ìš° ì‘ì€ ê²½ìš°, normal dataì™€ ê·¼ì ‘í•˜ëŠ” ê²½ìš°ì— reconstruction errorê°€ ë§¤ìš° ì‘ì•„ detectionì´ ì˜ ì•ˆë¨.

#### GAN-based multivariate time series AD

- GANì„ ì´ìš©í•˜ì—¬ anomaly detection í•˜ëŠ” ë°©ë²•
- generatorì™€ discriminator ë‘ ê°œì˜ ëª¨ë¸ì„ ì´ìš©í•˜ì—¬ generatorëŠ” ì‹¤ì œì™€ ë¹„ìŠ·í•˜ê²Œ samplesë¥¼ ìƒì„±í•˜ì—¬ discriminatorë¥¼ ì†ì´ê³  discriminatorëŠ” generatorê°€ ë§Œë“  ê°€ì§œë¥¼ ì°¾ì•„ë‚´ëŠ” ë°©ë²•
- GAN-ADì— ëŒ€í•´ì„œëŠ” ì €ë²ˆ í¬ìŠ¤íŠ¸ì—ì„œ ìì„¸í•˜ê²Œ ë‹¤ë¤˜ìœ¼ë‹ˆ ì°¸ê³ í•  ê²ƒ [í¬ìŠ¤íŠ¸ ë³´ëŸ¬ê°€ê¸°](https://hwk0702.github.io/treatise%20review/2021/02/08/GAN_AD/)

<img src='/img/usad4.png' width='600'>

- í•™ìŠµì´ ë¶ˆì•ˆì •í•˜ì—¬ mode collapse, non-convergence ë¬¸ì œê°€ ì¡´ì¬

---

### Unsupervised Anomaly Detection(USAD)

- ë‘ ë‹¨ê³„ì˜ Adversarial training framework ë‚´ì˜ AE ì•„í‚¤í…ì²˜ ì´ìš©
- ì„¸ê°€ì§€ elementsë¡œ êµ¬ì„±
  - encoder network $$E$$, two decoder networks $$D_1, \;D_2$$

$$AE_1(W)=D_1(E(W)), \;\; AE_2(W)=D_2(E(W))$$

1) ë‘ AEê°€ normal input windows Wë¥¼ ì¬êµ¬ì¶•í•˜ê²Œ í•™ìŠµ
2) ë‘ AEê°€ adversarialí•˜ê²Œ í•™ìŠµ, $$AE_1$$ì€ $$AE_2$$ë¥¼ ì†ì´ê²Œ í•™ìŠµí•˜ê³ , $$AE_2$$ëŠ” ì‹¤ì œ ë°ì´í„°ì™€ $$AE_1$$ìœ¼ë¡œë¶€í„° ì¬êµ¬ì¶•ëœ ë°ì´í„° êµ¬ë³„í•˜ê²Œ í•™ìŠµ

<img src='/img/usad2.png' width='600'>

#### Phase 1. Autoencoder training

- Input data Wë¥¼ encoder Eë¥¼ ì´ìš©í•˜ì—¬ latent space Zë¡œ ì••ì¶•, ê° decoderë¡œ ì¬êµ¬ì¶•í•˜ê²Œ í•™
- ì´ë•Œ, adversarial trainingì„ ìœ„í•´ Encoder ğ‘¬, Decoder ğ‘«ğŸ, Decoder ğ‘«ğŸë¥¼ ê¸°ë°˜ìœ¼ë¡œ encoderë¥¼ ê³µìœ í•˜ëŠ” ë‘ ê°œì˜ AEë¥¼ êµ¬ì¶•í•¨

$$\begin{matrix}
\mathscr{L}_{AE_1} = \left \| W-AE_1(W) \right \|_2 \\
\mathscr{L}_{AE_2} = \left \| W-AE_2(W) \right \|_2 \\
\end{matrix}$$

<img src='/img/usad6.png' width='600'>

#### Phase 2. Adverserial training

- $$AE_2$$ëŠ” ì‹¤ì œ ë°ì´í„°ì™€ $$AE_1$$ì´ ë§Œë“  ë°ì´í„° êµ¬ë³„í•˜ê²Œ í•™ìŠµ
- $$AE_1$$ëŠ” $$AE_2$$ë¥¼ ì†ì´ê²Œ í•™ìŠµ

$$\underset{AE_1}{\text{min}}\underset{AE_2}{\text{max}}\left \| W-AE_2(AE_1(W)) \right \|_2$$

<img src='/img/usad7.png' width='600'>

#### Two-phase training

- USADë¥¼ êµ¬ì„±í•˜ëŠ” ë‘ AEì˜ í•™ìŠµëª©í‘œëŠ” ë‹¤ìŒê³¼ ê°™ìŒ
  - $$AE_1$$: inputì„ ì˜ ë³µì›í•˜ë©´ì„œ $$AE_2$$ë¥¼ ì˜ ì†ì´ëŠ” ëª¨ë¸ í•™ìŠµ
  - $$AE_2$$: inputì„ ì˜ ë³µì›í•˜ë©´ì„œ $$AE_1$$ì´ ë³µì›í•œ ë°ì´í„°ì™€ inputì„ ì˜ êµ¬ë³„í•˜ëŠ” ëª¨ë¸ í•™ìŠµ
- $$AE_2$$ ë„ì… ë° adversarial trainingì„ í†µí•´ ì •ìƒ ë°ì´í„°ì™€ ìœ ì‚¬í•œ ì´ìƒì¹˜ë¥¼ íƒì§€í•˜ëŠ” ê²ƒì„ ê°€ëŠ¥í•˜ê²Œ í•˜ë©°, AE êµ¬ì¡°ë¥¼ í†µí•´ ì•ˆì •ì ì¸ í•™ìŠµì´ ê°€ëŠ¥í•˜ê²Œ í•¨

$$\begin{matrix}
\mathscr{L}_{AE_1}=\frac{1}{n}\left \| W-AE_1(W) \right \|_2 + (1-\frac{1}{n})\left \| W-AE_2(AE_1(W)) \right \|_2 \\
\mathscr{L}_{AE_2}=\frac{1}{n}\left \| W-AE_2(W) \right \|_2 - (1-\frac{1}{n})\left \| W-AE_2(AE_1(W)) \right \|_2 
\end{matrix}$$

- nì€ epoch
- ì•ˆì •ì ì¸ í•™ìŠµì„ ìœ„í•´ ì´ˆë°˜ì—ëŠ” reconstructionì— ê°€ì¤‘ì¹˜ë¥¼ ì£¼ê³ , í›„ë°˜ì—ëŠ” adversarial trainingì— ê°€ì¤‘ì¹˜ ë¶€ì—¬

#### Inference

- anomaly score
  - í•™ìŠµì´ ì™„ë£Œëœ ë‘ AEë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì•„ë˜ì™€ ê°™ì´ anomaly scoreë¥¼ ì‚°ì¶œí•¨
$$\mathscr{A}(\hat{W})=\alpha\left \| \hat{W} - AE_1(\hat{W}) \right \|_2+\beta\left \| \hat{W} - AE_2(AE_1(\hat{W})) \right \|_2$$
  - $$\alpha+\beta=1$$

  <img src='/img/usad8.png' width='600'>

  - ê³„ìˆ˜ì˜ ë¹„ì¤‘ì— ë”°ë¼ ì•„ë˜ì™€ ê°™ì´ false positiveì™€ true positive ê°„ì˜ trade-offê°€ ë°œìƒí•¨
    - ğœ¶ > ğœ·: true & false positive ê°ì†Œ â†’ low detection sensitivity scenario 
    - ğœ¶ < ğœ·: true & false positive ì¦ê°€ â†’ high detection sensitivity scenario

|               |          | True                     | True                      |
| ------------- | -------- | ------------------------ | ------------------------- |
|               |          | Abnormal                 | Normal                    |
| **Predicted** | Abnormal | **<u>True Positive</u>** | **<u>False Positive</u>** |
| **Predicted** | Normal   | False Negative           | True Negative             |

-----

### Experiments and results

#### Datasets

- 5ê°œì˜ publicly available datasetsê³¼ 1ê°œì˜ internal datasetìœ¼ë¡œ ê²°ê³¼ë¥¼ ëƒ„
- Window ë‚´ë¶€ì˜ í•œ ì‹œì ì´ë¼ë„ abnormalì´ë©´ í•´ë‹¹ êµ¬ê°„ì˜ ground truthë¥¼ abnormalë¡œ ë¶€ì—¬í•˜ëŠ” point-adjust ë°©ì‹ì„ í†µí•´ ëª¨ë¸ì˜ ì„±ëŠ¥ì„ í‰ê°€í•¨

<img src='/img/usad9.png' width='400'>

#### Evaluation Metrics

- Precision($$P$$), Recall($$R$$), F1 score($$F1$$), average precisionê³¼ average recallì„ ì´ìš©í•˜ì—¬ ê³„ì‚°í•œ F1 score($$F1^*$$) ì‚¬ìš©í•˜ì—¬ í‰ê°€

$$P=\frac{TP}{TP+FP}, \;\; R=\frac{TP}{TP+FN}, \;\; F1=2\cdot\frac{P\cdot R}{P+R}, \;\; F1^*=2\cdot\frac{\bar{P}\cdot \bar{R}}{\bar{P}+\bar{R}} $$

#### Baselines

- 5ê°œì˜ baselinesë¥¼ ì´ìš©í•˜ì—¬ ë¹„êµ

<img src='/img/usad10.png' width='400'>

#### Overall performance

- ì œì•ˆí•œ ë°©ë²•ë¡ ì´ ëŒ€ë¶€ë¶„ì˜ ë°ì´í„°ì—ì„œ ìš°ìˆ˜í•œ ì„±ëŠ¥ì„ ë„ì¶œí•¨
- ì‹œê³„ì—´ ì •ë³´ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šì€ IFì™€ DAGMMì´ ë‚®ì€ ì„±ëŠ¥ì„ ë„ì¶œí•˜ëŠ” ê²ƒì„ í†µí•´ temporal informationì„ ëª¨ë¸ë§í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•¨ì„ ì•Œ ìˆ˜ ìˆìŒ

<img src='/img/usad11.png' width='600'>

#### Effect of parameters

- SWaT datasetì„ ê¸°ë°˜ìœ¼ë¡œ ì´ 4ê°œì˜ parameterê°€ ëª¨ë¸ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ í™•ì¸í•¨
  - Down-sampling: ë°ì´í„°ë¥¼ ìƒ˜í”Œë§í•˜ëŠ” ì£¼ê¸°
  - Windows size: inputì˜ sequence ê¸¸ì´
  - Dimension of latent space: AEì˜ latent space ì°¨ì›
  - Percentage of anomalies: train datasetì— í¬í•¨ë˜ëŠ” anomaly ë¹„ìœ¨

- Down-samplingê°’ì´ 5ì¼ë•Œ ìµœê³  ì„±ëŠ¥ì„ ë„ì¶œí•˜ë©°,ë¹„ìœ¨ì˜ ê°’ì— ê´€ê³„ ì—†ì´ ì¼ì •í•œ ì„±ëŠ¥ì„ ë„ì¶œí•˜ëŠ” ê²ƒì„ í†µí•´ ëª¨ë¸ì´ down-samplingì— ë¯¼ê°í•˜ì§€ ì•ŠìŒì„ ì•Œ ìˆ˜ ìˆìŒ
- Window sizeê°€ 10ì¼ë•Œ ìµœê³  ì„±ëŠ¥ì„ ë„ì¶œí•˜ëŠ” ê²ƒì„ í†µí•´ ê° ì‹œì ì´ ì´ìƒì¹˜ íƒì§€ì— í° ì˜í–¥ì„ ë¯¸ì¹˜ê³  USADê°€ ì´ìƒì¹˜ë¥¼ ë¹ ë¥´ê²Œ íƒì§€í•  ìˆ˜ ìˆë‹¤ê³  ë³¼ ìˆ˜ ìˆìŒ

<img src='/img/usad12.png' width='600'>

- Dimension of latent spaceê°€ 20ì¼ ë•Œ ìµœê³  ì„±ëŠ¥ì„ ë„ì¶œí•˜ë©°, ê°’ì´ ì‘ì„ ë•ŒëŠ” ì •ë³´ ì†ì‹¤ì´ ë°œìƒí•˜ê³  í´ ë•ŒëŠ” memorizationì´ ë°œìƒí•´ ì„±ëŠ¥ì´ ë‚®ì€ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ
- Training dataì˜ percentage of anomaliesê°€ ì¦ê°€í•¨ì— ë”°ë¼ precisionì´ í¬ê²Œ ê°ì†Œí•˜ëŠ” ê²ƒì„ í†µí•´ false positiveê°€ ì¦ê°€í•¨ì„ ì•Œ ìˆ˜ ìˆìŒ

<img src='/img/usad13.png' width='600'>

- anomalyscoreì˜ parameter ğœ¶ì™€ ğœ·ì˜ ê°’ì—ë”°ë¼ ìƒì´í•œ ê²°ê³¼ê°€ ë„ì¶œë˜ëŠ” ê²ƒì„ í†µí•´ ëª¨ë¸ì´ ğœ¶ì™€ ğœ·ì— ë¯¼ê°í•¨ì„ ì•Œ ìˆ˜ ìˆìœ¼ë©°, ğœ¶ê°€ ì¦ê°€í•˜ê³  ğœ·ê°€ ê°ì†Œí• ìˆ˜ë¡ false positiveì™€ true positiveê°€ ëª¨ë‘ ê°ì†Œí•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆìŒ

<img src='/img/usad16.png' width='250'>

#### Ablation Study

- SMD, SMAP, MSL datasetsì„ ê¸°ë°˜ìœ¼ë¡œ 2ê°œì˜ phaseì˜ íš¨ê³¼ë¥¼ ê²€ì¦
- Adversarial trainingì˜ ì ‘ëª©ì´ AEì˜ ì„±ëŠ¥ì„ ìœ ì˜ë¯¸í•˜ê²Œ í–¥ìƒì‹œí‚¤ëŠ” ê²ƒì„ í†µí•´ adversarial trainingì´ ì •ìƒ ë°ì´í„°ì™€ ìœ ì‚¬í•œ ì´ìƒì¹˜ë¥¼ íƒì§€í•˜ëŠ”ë° ë„ì›€ì´ ëœë‹¤ê³  ë³¼ ìˆ˜ ìˆìŒ

<img src='/img/usad14.png' width='500'>

#### Feasibility Study

- ì‹¤ì œí˜„ì¥ì—ì„œ ì‚¬ìš©ë˜ëŠ” internal datasetì„ ê¸°ë°˜ìœ¼ë¡œ ì œì•ˆí•œ ëª¨ë¸ì˜ feasibilityë¥¼ ê²€ì¦í•œ ê²°ê³¼ ì´ìƒì¹˜ íƒì§€ ì„±ëŠ¥ì´ ìš°ìˆ˜í•œê²ƒì„ í™•ì¸í•¨

<img src='/img/usad16.png' width='250'>

<img src='/img/usad15.png' width='600'>